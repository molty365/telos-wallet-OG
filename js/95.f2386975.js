"use strict";(globalThis["webpackChunktelos_web_wallet"]=globalThis["webpackChunktelos_web_wallet"]||[]).push([[95],{84095:(e,t,s)=>{s.r(t),s.d(t,{default:()=>oe});var a=s(59835),n=s(86970);const o={class:"c-send-page__title-container"},i={class:"o-text--header-1 u-text--high-contrast"},r={class:"o-text--paragraph u-text--default-contrast"},l={class:"c-send-page__form-container"},c={class:"c-send-page__row c-send-page__row--1 row"},d={class:"col"},u={class:"c-send-page__row c-send-page__row--3 row"},m={class:"col-12 col-sm-auto c-send-page__token-selection-container"},g={class:"c-send-page__selector-op-avatar"},h=["src"],_={class:"c-send-page__view-contract-text"},p={class:"col"},f={class:"c-send-page__row c-send-page__row--4 row"},w={class:"col-auto"},k={class:"c-send-page__gas-fee"},y={class:"row o-text--header-5 u-text--default-contrast text-no-wrap"},v={class:"row c-send-page__gas-fee-info"},b={class:"flex items-center justify-center col-auto q-mr-xs flex-column"},C={class:"col-auto"},T={class:"row text-no-wrap o-text--small u-text--default-contrast"},I={class:"row text-no-wrap o-text--small u-text--default-contrast"},x={class:"c-send-page__row c-send-page__row--5 row"},E={class:"col"},F={class:"justify-end row"};function S(e,t,s,S,V,$){const L=(0,a.up)("UserInfo"),R=(0,a.up)("q-spinner"),q=(0,a.up)("AddressInput"),U=(0,a.up)("q-item-label"),Z=(0,a.up)("q-item"),A=(0,a.up)("q-select"),G=(0,a.up)("q-space"),z=(0,a.up)("q-icon"),W=(0,a.up)("CurrencyInput"),B=(0,a.up)("q-btn"),M=(0,a.up)("q-form"),N=(0,a.up)("AppPage");return(0,a.wg)(),(0,a.j4)(N,null,{header:(0,a.w5)((()=>[(0,a._)("div",o,[(0,a._)("div",i,(0,n.zw)(e.$t("evm_wallet.send")),1),(0,a._)("div",r,(0,n.zw)(e.$t("global.from")),1),(0,a.Wm)(L,{class:"c-send-page__title-addressu-text--default-contrast",displayFullAddress:!1,showAddress:!0,showCopyBtn:!1,lightweight:!0,account:e.loggedAccount},null,8,["account"])])])),default:(0,a.w5)((()=>[(0,a._)("div",l,[e.balances?.length?((0,a.wg)(),(0,a.j4)(M,{key:1,class:"c-send-page__form"},{default:(0,a.w5)((()=>[(0,a._)("div",c,[(0,a._)("div",d,[(0,a.Wm)(q,{modelValue:e.address,"onUpdate:modelValue":t[0]||(t[0]=t=>e.address=t),name:"send-page-address-input",label:e.$t("evm_wallet.receiving_account"),"onUpdate:isValid":t[1]||(t[1]=t=>e.addressIsValid=t)},null,8,["modelValue","label"])])]),(0,a._)("div",u,[(0,a._)("div",m,[(0,a.Wm)(A,{modelValue:e.selected,"onUpdate:modelValue":t[2]||(t[2]=t=>e.selected=t),outlined:"",label:e.$t("evm_wallet.token"),options:e.balances,class:"c-send-page__token-selector"},{selected:(0,a.w5)((()=>[(0,a._)("span",null,(0,n.zw)(e.token?.symbol),1)])),option:(0,a.w5)((t=>[(0,a.Wm)(Z,(0,a.dG)({class:"c-send-page__selector-op"},t.itemProps),{default:(0,a.w5)((()=>[(0,a._)("div",g,[(0,a._)("img",{class:"c-send-page__selector-op-icon",src:t.opt.token.logoURI,alt:"Token Logo"},null,8,h)]),(0,a._)("div",null,[(0,a.Wm)(U,{class:"c-send-page__selector-op-name"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,n.zw)(t.opt.token.name),1)])),_:2},1024),(0,a.Wm)(U,{class:"c-send-page__selector-op-balance",caption:""},{default:(0,a.w5)((()=>[(0,a.Uk)((0,n.zw)(e.prettyPrintBalance(t.opt.str,e.fiatLocale,e.isMobile,t.opt.token.symbol)),1)])),_:2},1024)])])),_:2},1040)])),_:1},8,["modelValue","label","options"]),(0,a._)("div",{class:(0,n.C_)({"c-send-page__view-contract":!0,"c-send-page__view-contract--hidden":!e.showContractLink}),onClick:t[3]||(t[3]=(...t)=>e.viewTokenContract&&e.viewTokenContract(...t))},[(0,a._)("span",_,(0,n.zw)(e.$t("evm_wallet.view_contract")),1),e.isMobile?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(G,{key:0})),(0,a.Wm)(z,{size:"xs",name:"o_launch",class:"c-send-page__view-contract-min-icon"})],2)]),(0,a._)("div",p,[(0,a.Wm)(W,(0,a.dG)({ref:"currencyInput",modelValue:e.amount,"onUpdate:modelValue":t[4]||(t[4]=t=>e.amount=t)},e.currencyInputSecondaryCurrencyBindings,{loading:e.currencyInputIsLoading,locale:e.fiatLocale,decimals:e.tokenDecimals,symbol:e.tokenSymbol,"max-value":e.availableInTokensBn,"error-if-over-max":!0,label:e.$t("global.amount"),required:"required",name:"send-page-currency-input"}),null,16,["modelValue","loading","locale","decimals","symbol","max-value","label"])])]),(0,a._)("div",f,[(0,a.Wm)(G),(0,a._)("div",w,[(0,a._)("div",k,[(0,a._)("div",y,(0,n.zw)(e.$t("evm_wallet.estimated_fees")),1),(0,a._)("div",v,[(0,a.Wm)(G),(0,a._)("div",b,[(0,a.Wm)(z,{class:"c-send-page__gas-icon",name:"local_gas_station"})]),(0,a._)("div",C,[(0,a._)("div",T,(0,n.zw)(e.gasFeeInSystemSym),1),(0,a._)("div",I,(0,n.zw)(e.gasFeeInFiat),1)])])])])]),(0,a._)("div",x,[(0,a._)("div",E,[(0,a._)("div",F,[(0,a.Wm)(B,{color:"primary",class:"wallet-btn",label:e.$t("evm_wallet.send"),loading:e.isLoading,disable:!e.isFormValid||e.isLoading,onClick:e.startTransfer},null,8,["label","loading","disable","onClick"])])])])])),_:1})):((0,a.wg)(),(0,a.j4)(R,{key:0}))])])),_:1})}var V=s(24352),$=s(20902),L=s(84193),R=s(77155),q=s(43446),U=s(84746),Z=s(39447),A=s(92338),G=s(36306),z=s(17779);const W=26250,B=55500,M=(0,L.getAntelope)(),N=(0,L.useUserStore)(),Y=(0,L.useAccountStore)(),Q=(0,L.useChainStore)(),j=(0,a.aZ)({name:"SendPage",components:{AddressInput:G.Z,CurrencyInput:A.Z,AppPage:V.Z,UserInfo:$.Z},data:()=>({address:"",addressIsValid:!1,fiatConversionRate:0,selected:null,amount:U.O$.from(0),estimatedGas:{system:Z._Y,fiat:Z._Y},prettyPrintBalance:q.ze}),watch:{balances:{handler(){let e=this.selected;if(this.selected=null,this.balances.length>0){const t=this.$route.query.token;t&&(e=this.balances.find((e=>e.token.address===t))??e,this.$router.replace({name:"evm-send",params:{token:void 0}})),e||(e=this.balances.find((e=>e.token.address===R.L4))??e),e||(e=this.balances[0])}this.selected=e},immediate:!0,deep:!0},token:{async handler(e,t){this.updateTokenTransferConfig(this.isFormValid,e,this.address,this.amount),e?.address!==t?.address&&(this.updateEstimatedGas(),this.fiatConversionRate=e?+e.price.str:void 0)},immediate:!0,deep:!0},selected(){this.amount=U.O$.from(0),this.$refs.currencyInput?.resetEmptyError()},isFormValid(e){this.updateTokenTransferConfig(e,this.token,this.address,this.amount)},address(e){this.updateTokenTransferConfig(this.isFormValid,this.token,e,this.amount)},amount(e){this.updateTokenTransferConfig(this.isFormValid,this.token,this.address,e)}},computed:{token(){return this.selected?.token??null},loggedAccount(){return Y.loggedEvmAccount},gasFeeInSystemSym(){const e=Q.loggedChain.settings.getSystemToken().symbol,t=Q.loggedChain.settings.getSystemToken().decimals,s=`${(0,q.rE)(this.estimatedGas.system,t,q.Rs)}`;return(0,q.ze)(s,N.fiatLocale,this.isMobile,e)},gasFeeInFiat(){const e=Q.loggedChain.settings.getSystemToken().decimals,t=`${(0,q.rE)(this.estimatedGas.fiat,e,q.Rs)}`;return(0,q.yD)(t,N.fiatLocale,this.isMobile,N.fiatCurrency)},isMobile(){return this.$q.screen.lt.sm},balances(){return M.stores.balances.getBalances(L.CURRENT_CONTEXT)},showContractLink(){return this.token?.address!==R.L4},currencyInputSecondaryCurrencyBindings(){const e=!!this.fiatConversionRate;return e?{secondaryCurrencyCode:N.fiatCurrency,secondaryCurrencyConversionFactor:this.fiatConversionRate,secondaryCurrencyDecimals:2}:{}},fiatLocale(){return N.fiatLocale},tokenSymbol(){return this.token?.symbol??Q.loggedChain.settings.getSystemToken().symbol},tokenDecimals(){return this.token?.decimals??0},availableInTokensBn(){if(!this.selected)return Z._Y;if(!this.selected.balance)return Z._Y;const e=this.selected.balance.sub(this.selected.isSystem?this.estimatedGas.system:Z._Y);return e.gt(Z._Y)?e:Z._Y},isFormValid(){return this.addressIsValid&&!(this.amount.isZero()||this.amount.isNegative()||this.amount.gt(this.availableInTokensBn))},isLoading(){return M.stores.feedback.isLoading("transferEVMTokens")||this.isFormValid&&!this.authIsReadyForTransfer},authIsReadyForTransfer(){return Y.getEVMAuthenticator(L.CURRENT_CONTEXT)?.readyForTransfer()??!1},currencyInputIsLoading(){return!(this.token?.decimals&&this.token?.symbol)}},created(){this.clearTokenTransferConfigs()},unmounted(){this.clearTokenTransferConfigs()},methods:{async updateEstimatedGas(){const e=Q.loggedEvmChain?.settings;e?this.token?.isSystem?this.estimatedGas=await e.getEstimatedGas(W):this.estimatedGas=await e.getEstimatedGas(B):this.estimatedGas={system:Z._Y,fiat:Z._Y}},viewTokenContract(){if(this.token){const e=M.stores.chain.loggedEvmChain?.settings.getExplorerUrl();if(e)return void window.open(e+"/address/"+this.token.address,"_blank");M.config.notifyFailureMessage(this.$t("settings.no_explorer",{network:M.stores.chain.currentChain?.settings.getNetwork()}))}},clearTokenTransferConfigs(){this.updateTokenTransferConfig(!1,null,this.address,this.amount)},async updateTokenTransferConfig(e,t,s,a){await(this.loggedAccount?.authenticator.prepareTokenForTransfer(e?t:null,a,s))},async startTransfer(){const e=L.CURRENT_CONTEXT;if(!await(0,L.useAccountStore)().assertNetworkConnection(e))return void(this.amount=Z._Y);const t=this.token,s=this.amount,a=this.address;this.isFormValid?M.stores.balances.transferTokens(t,a,s).then((e=>{const n=M.stores.chain.loggedEvmChain?.settings;if(n){const o=`${(0,q.rE)(s,t.decimals,q.Rs)} ${t.symbol}`,i=a.substring(0,6)+"..."+a.substring(a.length-4,a.length),r=M.config.notifyNeutralMessageHandler(this.$t("notification.neutral_message_sending",{quantity:o,address:i}));e.wait().then((t=>{M.config.notifySuccessfulTrxHandler(`${n.getExplorerUrl()}/tx/${e.hash}`)})).catch((e=>{z.error(e)})).finally((()=>{r()}))}})).catch((e=>{z.error(e)})):M.config.notifyFailureMessage(this.$t("evm_wallet.invalid_form"))}}});var P=s(11639),O=s(13902),D=s(8326),X=s(4581),H=s(490),J=s(33115),K=s(90136),ee=s(22857),te=s(68879),se=s(69984),ae=s.n(se);const ne=(0,P.Z)(j,[["render",S]]),oe=ne;ae()(j,"components",{QSpinner:O.Z,QForm:D.Z,QSelect:X.Z,QItem:H.Z,QItemLabel:J.Z,QSpace:K.Z,QIcon:ee.Z,QBtn:te.Z})}}]);